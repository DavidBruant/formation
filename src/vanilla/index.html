<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">

    <meta description="">
    <link rel="stylesheet" type="text/css" href="../../style.css">

    <script>
      "use strict";

      document.addEventListener('DOMContentLoaded', function(e){

        function fetchJson(url) {
          return fetch(url)
          .then(function (resp) {
            return resp.json();
          })
          .catch(function(err) {
            console.error(err);
          });
        }

        const urls = [
          'https://raw.githubusercontent.com/iOiurson/formation/correction/data/tweets.json',
          'https://raw.githubusercontent.com/iOiurson/formation/correction/data/tweets2.json'
        ];

        Promise.all(urls.map(fetchJson))
        .then(function(tweets){
          tweets = tweets[0].concat(tweets[1]);

          console.log('Le tableau de tweet', tweets);

// ### 2/ Twitter ###

          // [1] créer une fonction, qui pour un tweet en entrée, créé et retourne un <li> contenant le texte du tweet
          function createLi(tweet) {
            const li = document.createElement('li');
            li.textContent = tweet.text;
            return li;
          }

          // let ol = document.createElement('ol');
          let ol = createOl(tweets);
          document.body.append(ol);

          // [2] ajouter les tweets à la page en utilisant [1]
          // tweets.forEach(function(tweet){
          //   const li = createLi(tweet);
          //   ol.append(li);
          // });

          // créer et ajouter un <button> qui quand on clique dessus affiche 'click' dans la console.
          const bouton = document.createElement('button');
          bouton.textContent = 'to Fr';
          document.body.append(bouton);

          let isFr = false;

          bouton.addEventListener('click', function() {
            let tweetsToDisplay = !isFr
              ? tweets.filter(function (tweet) {
                return tweet.lang === 'fr';
              })
              : tweets;

            const newOl = createOl(tweetsToDisplay);

            bouton.textContent = !isFr
              ? 'to International'
              : 'to Fr';

            ol.replaceWith(newOl);
            ol = newOl;

            isFr = !isFr;

          });

          /* modifier le bouton pour que,
            quand on clique dessus, ne garde que les tweets en français (et quand on reclique re-affiche tout) */


          /* créer une fonction, qui pour un tableau tweets en entrée, crée et retourne un <ol> rempli de <li>
          et l'utiliser à [2] */

          function createOl(tweets) {
            const ol = document.createElement('ol');

            tweets.map(createLi)
            .forEach(function (li) {
              ol.append(li);
            });

            return ol;
          }

          // Créer un bouton qui active le tracking de la position de la souris (event.clientX, event.clientY), et le désactive quand on reclique dessus

          const trackingButton = document.createElement('button');
          trackingButton.textContent = 'Activer le tracking';
          document.body.append(trackingButton);

          let isTracking = false;

          function track(event) {
            // console.log('X:', event.clientX, 'Y:', event.clientY);
            // console.log('X: ' + event.clientX + ' Y: ' + event.clientY);
            console.log(`X: ${event.clientX} Y: ${event.clientY}`);
          }

          trackingButton.addEventListener('click', function() {
            if (!isTracking) {
              window.addEventListener('mousemove', track);
              trackingButton.textContent = 'Désactiver le tracking';
            }
            else {
              window.removeEventListener('mousemove', track);
              trackingButton.textContent = 'Activer le tracking';
            }

            isTracking = !isTracking;
          });



// Présentation Asynchronicité

          // Ecrire une fonction 'fetchJson' qui a comme paramètre une url et qui retourne une promesses pour des tweets en utilisant fetch


          /* charger et afficher les tweets de
          'https://raw.githubusercontent.com/iOiurson/formation/correction/data/tweets2.json'*/


          /* Créer plusieurs fichiers avec du code
            - createTweetLi.js
            - createTweetsOl.js
            - createTrackingButton.js
            - fetchJson.js
            - main.js
          */


          // charger tout ça via des <script defer src="..."> dans le <head>


// Présentation Modules

// ### BONUS 1: LOCALSTORAGE ###
            // 1) Rajouter un bouton "fav" à chaque li


            /* 2) quand le bouton est cliqué, changer le style du li (rajouter une classe 'fav')
            + et stocker l'ensemble des id_str fav dans le localStorage */


            // 3) au chargement de la page, lire le localStorage pour favoriser les favoris.


// ### BONUS 2: TIMING EVENEMENTS ###

            /* Faites un bouton (un peu gros) qui écoute mousedown/click/dblclick et mesure le temps de click et de doubleclick
            et affiche tempsClic1, tempsClic2, tempsDoubleClic */


        })
        .catch(function(e){ console.error(e) });

      }, {once: true})
    </script>

    <title>yo</title>
  </head>

  <body>
    <div>COUCOU</div>
  </body>

</html>
